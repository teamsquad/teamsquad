<table class="games" cellpadding="0" cellspacing="0" summary="List of matches.">
  <tbody><% previous_hierarchy = ''; for game in matches %>
    <% if game.hierarchy != previous_hierarchy && !matches.all? { |match| match.hierarchy == matches.first.hierarchy } -%>
    <% previous_hierarchy = game.hierarchy -%>
    <tr>
        <th colspan="6"><%= link_to game.hierarchy, stage_url(:competition => game.competition, :stage => game.stage, :anchor => game.group.slug) %></th>
    </tr>
    <% end %>
    <tr class="<%= game.state %>">
      <td class="home team"><%= (game.home_team && link_to(game.home_team.title, team_url(:team=> game.home_team))) || "To be arranged" %></td>
      <% if game.played? -%>
      <td class="home score"><%= game.home_score %></td>
      <td class="versus">v</td>
      <td class="away score"><%= game.away_score %></td>
      <% else -%>
      <td class="when" colspan="3"><%= game.pretty_time %></td>
      <% end -%>
      <td class="away team"><%= (game.away_team && link_to(game.away_team.title, team_url(:team => game.away_team))) || "To be arranged" %></td>
    </tr><% if game.has_notes? %>
    <tr class="notes">
      <td class="home" colspan="2"><%= game.home_notes %></td>
      <td colspan="3">&nbsp;</td>
      <td class="away" colspan="2"><%= game.away_notes %></td>
    </tr><% end %><% if game.has_summary? %>
    <tr class="<%= game.summary.length < 64 ? 'short ' : '' %>summary">
      <td colspan="5"><%= game.summary %></td>
    </tr><% end %><% end %>
  </tbody>
</table>
